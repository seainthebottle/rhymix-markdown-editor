!function(r,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["markdown-it-imsize.js"]=t():r["markdown-it-imsize.js"]=t()}(self,(()=>(()=>{var r={764:r=>{"use strict";function t(r,t,e){var n,i=t,o={ok:!1,pos:t,value:""};for(n=r.charCodeAt(t);t<e&&n>=48&&n<=57||37===n;)n=r.charCodeAt(++t);return o.ok=!0,o.pos=t,o.value=r.slice(i,t),o}function e(r,t,e){for(var n=r.charCodeAt(t);t<e&&(32==n||9==n);)n=r.charCodeAt(++t);return t}r.exports=function(r,n,i){var o,s={ok:!1,pos:0,width:"",height:""};if(n>=i)return s;if(61!==(o=r.charCodeAt(n)))return s;if(n=e(r,++n,i),120!==(o=r.charCodeAt(n))&&(o<48||o>57))return s;var c=t(r,n=e(r,n,i),i);if(n=e(r,n=c.pos,i),120!==(o=r.charCodeAt(n)))return s;var a=t(r,n=e(r,++n,i),i);return n=a.pos,s.width=c.value,s.height=a.value,s.pos=n,s.ok=!0,s}},275:(r,t,e)=>{"use strict";var n={};e(106).forEach((function(r){n[r]=e(846)("./"+r).detect})),r.exports=function(r,t){var e;for(e in n)if(e in n&&n[e](r,t))return e;throw new TypeError("Unsupported type")}},943:(r,t,e)=>{"use strict";var n=e(152),i=e(671),o=e(275),s={};e(106).forEach((function(r){s[r]=e(846)("./"+r)}));var c=131072;function a(r,t){var e=o(r,t);if(e in s){var n=s[e].calculate(r,t);if(!1!==n)return n.type=e,n}throw new TypeError("Unsupported file type")}r.exports=function(r,t){if("string"!=typeof r)throw new TypeError("Input must be file name");var e=i.resolve(r);if("function"!=typeof t){var o=function(r){var t=n.openSync(r,"r"),e=n.fstatSync(t).size,i=Math.min(e,c),o=new Buffer(i);return n.readSync(t,o,0,i,0),n.closeSync(t),o}(e);return a(o,e)}!function(r,t){n.open(r,"r",(function(r,e){if(r)return t(r);var i=n.fstatSync(e).size,o=Math.min(i,c),s=new Buffer(o);n.read(e,s,0,o,0,(function(r){if(r)return t(r);n.close(e,(function(r){t(r,s)}))}))}))}(e,(function(r,n){if(r)return t(r);var i;try{i=a(n,e)}catch(t){r=t}t(r,i)}))}},174:r=>{"use strict";r.exports=function(r,t,e,n){return e=e||0,r["readUInt"+t+(n?"BE":"LE")].call(r,e)}},106:r=>{"use strict";r.exports=["bmp","gif","jpg","png","tiff"]},490:r=>{"use strict";r.exports={detect:function(r){return"BM"===r.toString("ascii",0,2)},calculate:function(r){return{width:r.readUInt32LE(18),height:r.readUInt32LE(22)}}}},185:r=>{"use strict";var t=/^GIF8[7,9]a/;r.exports={detect:function(r){var e=r.toString("ascii",0,6);return t.test(e)},calculate:function(r){return{width:r.readUInt16LE(6),height:r.readUInt16LE(8)}}}},223:r=>{"use strict";var t={ffdb:"0001010101",ffe0:"4a46494600",ffe1:"4578696600",ffe2:"4943435f50",ffe3:"",ffe8:"5350494646",ffec:"4475636b79",ffed:"50686f746f",ffee:"41646f6265"},e=["[31m","[39m"];function n(r,t){return{height:r.readUInt16BE(t),width:r.readUInt16BE(t+2)}}function i(r,t){if(t>r.length)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==r[t])throw new TypeError("Invalid JPG, marker table corrupted")}r.exports={detect:function(r){var n=r.toString("hex",0,2),i=r.toString("hex",2,4);if("ffd8"!==n)return!1;var o=r.toString("hex",6,11),s=i&&t[i];return""===s?(console.warn(e[0]+"this looks like a unrecognised jpeg\nplease report the issue here\n"+e[1],"\thttps://github.com/netroy/image-size/issues/new\n"),!1):o===s||"ffdb"===i},calculate:function(r){var t,e;for(r=r.slice(4);r.length;){if(t=r.readUInt16BE(0),i(r,t),192===(e=r[t+1])||194===e)return n(r,t+5);r=r.slice(t+2)}throw new TypeError("Invalid JPG, no size found")}}},992:r=>{"use strict";r.exports={detect:function(r){if("PNG\r\n\n"===r.toString("ascii",1,8)){if("IHDR"!==r.toString("ascii",12,16))throw new TypeError("invalid png");return!0}},calculate:function(r){return{width:r.readUInt32BE(16),height:r.readUInt32BE(20)}}}},649:r=>{"use strict";r.exports={detect:function(r){return"8BPS"===r.toString("ascii",0,4)},calculate:function(r){return{width:r.readUInt32BE(18),height:r.readUInt32BE(14)}}}},13:r=>{"use strict";var t=/<svg[^>]+[^>]*>/,e=/<svg [^>]+>/,n=/(^|\s)width\s*=\s*"(.+?)"/i,i=/(^|\s)height\s*=\s*"(.+?)"/i,o=/(^|\s)viewbox\s*=\s*"(.+?)"/i;r.exports={detect:function(r){return t.test(r)},calculate:function(r){var t=function(r){var t=r.toString().replace(/[\r\n\s]+/g," ").match(e),s=t&&t[0];if(s){var c=s.match(n),a=s.match(i),f=function(r){var t=1;if(r&&r[2]){var e=r[2].split(/\s/g);4===e.length&&(t=((e=e.map((function(r){return parseInt(r,10)})))[2]-e[0])/(e[3]-e[1]))}return t}(s.match(o));return{width:parseInt(c&&c[2],10)||0,height:parseInt(a&&a[2],10)||0,ratio:f}}}(r),s=t.width,c=t.height,a=t.ratio;if(s&&c)return{width:s,height:c};if(s)return{width:s,height:Math.floor(s/a)};if(c)return{width:Math.floor(c*a),height:c};throw new TypeError("invalid svg")}}},715:(r,t,e)=>{"use strict";var n=e(971),i=e(174);function o(r,t){var e=i(r,16,8,t);return(i(r,16,10,t)<<16)+e}function s(r){if(r.length>24)return r.slice(12)}r.exports={detect:function(r){var t=r.toString("hex",0,4);return"49492a00"===t||"4d4d002a"===t},calculate:function(r,t){if(!t)throw new TypeError("Tiff doesn't support buffer");var e="BE"===function(r){var t=r.toString("ascii",0,2);return"II"===t?"LE":"MM"===t?"BE":void 0}(r),c=function(r,t,e){var o=i(r,32,4,e),s=1024,c=n.statSync(t).size;o+s>c&&(s=c-o-10);var a=new Buffer(s),f=n.openSync(t,"r");return n.readSync(f,a,0,s,o),a.slice(2)}(r,t,e),a=function(r,t){for(var e,n,c,a={};r&&r.length&&(e=i(r,16,0,t),n=i(r,16,2,t),c=i(r,32,4,t),0!==e);)1===c&&3===n&&(a[e]=o(r,t)),r=s(r);return a}(c,e),f=a[256],u=a[257];if(!f||!u)throw new TypeError("Invalid Tiff, missing tags");return{width:f,height:u}}}},932:r=>{"use strict";r.exports={detect:function(r){var t="RIFF"===r.toString("ascii",0,4),e="WEBP"===r.toString("ascii",8,12),n="VP8"===r.toString("ascii",12,15);return t&&e&&n},calculate:function(r){var t=r.toString("ascii",12,16);if(r=r.slice(20,30),"VP8 "===t&&47!==r[0])return function(r){return{width:16383&r.readInt16LE(6),height:16383&r.readInt16LE(8)}}(r);var e=r.toString("hex",3,6);return"VP8L"===t&&"9d012a"!==e&&function(r){return{width:1+((63&r[2])<<8|r[1]),height:1+((15&r[4])<<10|r[3]<<2|(192&r[2])>>6)}}(r)}}},846:(r,t,e)=>{var n={"./bmp":490,"./bmp.js":490,"./gif":185,"./gif.js":185,"./jpg":223,"./jpg.js":223,"./png":992,"./png.js":992,"./psd":649,"./psd.js":649,"./svg":13,"./svg.js":13,"./tiff":715,"./tiff.js":715,"./webp":932,"./webp.js":932};function i(r){var t=o(r);return e(t)}function o(r){if(!e.o(n,r)){var t=new Error("Cannot find module '"+r+"'");throw t.code="MODULE_NOT_FOUND",t}return n[r]}i.keys=function(){return Object.keys(n)},i.resolve=o,r.exports=i,i.id=846},568:(r,t,e)=>{"use strict";var n=e(943),i=e(764);r.exports=function(r,t){r.inline.ruler.before("emphasis","image",function(r,t){return function(e,o){var s,c,a,f,u,h,p,d,l,v,g,w,m="",x="",y="",E=e.pos,I=e.posMax;if(33!==e.src.charCodeAt(e.pos))return!1;if(91!==e.src.charCodeAt(e.pos+1))return!1;if(u=e.pos+2,(f=r.helpers.parseLinkLabel(e,e.pos+1,!1))<0)return!1;if((h=f+1)<I&&40===e.src.charCodeAt(h)){for(h++;h<I&&(32===(c=e.src.charCodeAt(h))||10===c);h++);if(h>=I)return!1;for(w=h,(d=r.helpers.parseLinkDestination(e.src,h,e.posMax)).ok&&(y=e.md.normalizeLink(d.str),e.md.validateLink(y)?h=d.pos:y=""),w=h;h<I&&(32===(c=e.src.charCodeAt(h))||10===c);h++);if(d=r.helpers.parseLinkTitle(e.src,h,e.posMax),h<I&&w!==h&&d.ok)for(l=d.str,h=d.pos;h<I&&(32===(c=e.src.charCodeAt(h))||10===c);h++);else l="";if(h-1>=0&&32===(c=e.src.charCodeAt(h-1))&&(d=i(e.src,h,e.posMax)).ok)for(m=d.width,x=d.height,h=d.pos;h<I&&(32===(c=e.src.charCodeAt(h))||10===c);h++);if(h>=I||41!==e.src.charCodeAt(h))return e.pos=E,!1;h++}else{if(void 0===e.env.references)return!1;for(;h<I&&(32===(c=e.src.charCodeAt(h))||10===c);h++);if(h<I&&91===e.src.charCodeAt(h)?(w=h+1,(h=r.helpers.parseLinkLabel(e,h))>=0?a=e.src.slice(w,h++):h=f+1):h=f+1,a||(a=e.src.slice(u,f)),!(p=e.env.references[r.utils.normalizeReference(a)]))return e.pos=E,!1;y=p.href,l=p.title}if(!o){e.pos=u,e.posMax=f;var S=new e.md.inline.State(e.src.slice(u,f),e.md,e.env,g=[]);if(S.md.inline.tokenize(S),t&&t.autofill&&""===m&&""===x)try{var b=n(y);m=b.width,x=b.height}catch(r){}(v=e.push("image","img",0)).attrs=s=[["src",y],["alt",""]],v.children=g,l&&s.push(["title",l]),""!==m&&s.push(["width",m]),""!==x&&s.push(["height",x])}return e.pos=h,e.posMax=I,!0}}(r,t))}},971:()=>{},152:()=>{},671:()=>{}},t={};function e(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return r[n](o,o.exports,e),o.exports}return e.o=(r,t)=>Object.prototype.hasOwnProperty.call(r,t),e(568)})()));